---
title: "ds.client.connection.server Packages users documentation"
author: "Patricia Ryser-Welch on Behalf of the DataSHIELD Team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ds.client.connection.server Packages users documentation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction
The purpose of this package is support DataSHIELD analysts and programmers to connect to some Opal servers in more supportive manner. The package offers some functions that can simplify certain operations within DataSHIELD client scripts and functions. 

The latter includes:

1. Building some login data frames
2. Loging in and out of some DataSHIELD servers
3. Assigning values to some server variables
4. Executing some aggregates server-side functions 
5. Deleting some server-side variables
6. Checking some server-side variables exists

This package has been written to be used along the side the [dsBaseClient package](https://github.com/datashield/dsBaseClient).

We would recommed any new DataSHIELD users to install DataSHIELD and complete the training available on the DataSHIELD wiki; [Installation and training](https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/12943395/Installation+Training).

# Installed packages
During the installation, this package will import the following packages: 

* DSI
* DSOpal
* RCurl
* httr
* R6
* opalr

These packages are required to connect to an Opal Server, to manipulate some server-side variables and call server-side functions. The latter can be found in this repository: [dsBase](https://github.com/datashield/dsBase). It is worth noting, this package has been installed in an Opal Server. New server-side functions needs to be added or installed in an Opal server; instructions can be found [here](https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/12943483/How+to+upload+a+server-side+function).

## Libraries in DataSHIELD scripts
At the start of each DataSHIELD client script, DataSHIELD analysts need to load and attach these packages. 

```{r}
#Libraries 
library(DSI)
library(DSOpal)
library(httr)
library(ds.client.connection.server)
library(dsBaseClient)
```

# Building a login data frame
A login data frame provides the information to connect to any DataSHIELD servers; those servers have an Opal Data Warehouse software installed. On the client side, the following information needs to be provided to log in.

_data computers name_

```{r}
server.names <- c("Paris", "Newcastle", "New York")
```

_data computers url_

These unique resources link are likely to be unique. In this example, we are connecting to a virtual machine and hence using a different.

```{r}
url_Paris     <- 'https://192.168.56.100:8443'
url_Newcastle <- 'https://192.168.56.100:8443'
url_NewYork   <- 'https://192.168.56.100:8443'
server.urls     <- c(url_Paris,url_Newcastle,url_NewYork)
```

_data computers table name_ 

The name of these tables should exist on each server.  In the example below the table "TESTING.DATASET1" is assumed to be stored in Paris. 

```{r}
table_Paris     <- "TESTING.DATASET1"
table_Newcastle <- "TESTING.DATASET2"
table_NewYork   <- "TESTING.DATASET3"
server.tables   <- c(table_Paris, table_Newcastle, table_NewYork)
```

_users id_

The user id may be unique to each DataSHIELD server. 

```{r}
user_Paris      <-  "administrator"
user_Newcastle  <-  "administrator"
user_NewYork    <-  "administrator"
server.users.id <- c(user_Paris, user_Newcastle, user_NewYork)
```

_users password_

The password is likely to be unique for each DataSHIELD server. It should be provided by each organisation involved in giving access to the data.

```{R}
password_Paris      <-  "datashield_test&"
password_Newcastle  <-  "datashield_test&"
password_NewYork    <-  "datashield_test&"
server.users.pwd    <-  c(password_Paris, password_Newcastle, password_NewYork)
```

_options ssl_

The secure socket layer settings are likely to be unique for each DataSHIELD server. Each organisation should provide the details of these settings, when it gives access to their DataSHIELD server(s).

```{R}
ssl_options_Paris     <- "list(ssl_verifyhost=0,ssl_verifypeer=0)"
ssl_options_Newcastle <- "list(ssl_verifyhost=0,ssl_verifypeer=0)"
ssl_options_NewYork   <- "list(ssl_verifyhost=0,ssl_verifypeer=0)"
server.ssl.options    <- c(ssl_options_Paris,ssl_options_Newcastle,ssl_options_NewYork)
```

_driver connection_

The driver is likely to be set to "OpalDriver". This driver is used to connect to the Opal server.

```{R}
driver_Paris     <- "OpalDriver"
driver_Newcastle <- "OpalDriver"
driver_NewYork   <- "OpalDriver"
server.drivers   <- c(driver_Paris,driver_Newcastle,driver_NewYork)
```

_building the login data frame_

The function _ds.build.login.data.frame_ generates a valid data frame. This type of data 

```{R}
login.data <- ds.build.login.data.frame(server.names,
                                        server.urls,
                                        server.tables,
                                        server.users.id,
                                        server.users.pwd,
                                        server.ssl.options,
                                        server.drivers)
print(login.data)
```





The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
